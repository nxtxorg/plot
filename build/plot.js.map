{"version":3,"file":"plot.js","sources":["../src/plot.ts"],"sourcesContent":["import {NodeType, INxtx, Package, Node} from '../nxtx';\r\n\r\ndeclare const nxtx: INxtx;\r\n\r\nconst pkg: Package = {\r\n    name: 'plot',\r\n    commands: {\r\n        plot: (dictionaryNode: Node) => {\r\n            console.log(\"Drawing..\");\r\n            let {type, y, ylabel, xlabel} = dictionaryNode.value;\r\n            const canvas = <HTMLCanvasElement>nxtx.htmlLite(\"canvas\", {});\r\n\r\n            const yValue = dictionaryNode.value.y.value.map(e => e.value);\r\n\r\n            const ctx = canvas.getContext(\"2d\");\r\n\r\n            const canvasHeight = canvas.height = 200;\r\n            const canvasWidth = canvas.width = 400;\r\n\r\n            const offset = 30;\r\n            const graphHeight = canvasHeight -offset;\r\n            const graphWidth = canvasWidth -offset;\r\n\r\n            canvas.style.margin = \"auto\";\r\n            canvas.style.display = \"block\";\r\n            const normalizedY = normalize(yValue);\r\n            const spacing =graphWidth / (normalizedY.length-1);\r\n\r\n            ctx.imageSmoothingEnabled = true;\r\n            ctx.translate(0.5,0.5);\r\n\r\n\r\n            ///////////// Vertical labels\r\n            const yLabels = generateYLabels(yValue,10);\r\n            const verticalSpacing =graphHeight / (yLabels.length-1);\r\n\r\n            ctx.beginPath();\r\n            for(let i = 0;i<yLabels.length;i++){\r\n                line(ctx,offset,verticalSpacing*i,offset+5,verticalSpacing*i,1);\r\n                ctx.fillText(String(Math.round(yLabels[i])),0,i*verticalSpacing+4);\r\n            }\r\n            ctx.stroke();\r\n            ctx.closePath();\r\n\r\n\r\n            ///////////// Graph\r\n            ctx.beginPath();\r\n            for (let i = 0; i < normalizedY.length - 1; i++) {\r\n                line(ctx,i * spacing + offset, graphHeight-(normalizedY[i] * graphHeight),\r\n                    (i+1)*spacing + offset, graphHeight-(normalizedY[i + 1] * graphHeight),1);\r\n            }\r\n\r\n            ctx.stroke();\r\n            ctx.lineCap = \"round\";\r\n\r\n\r\n\r\n            //////// Borders\r\n            line(ctx,offset,0,offset,canvasHeight-offset+10);\r\n            line(ctx, offset-10,canvasHeight-offset ,canvasWidth,canvasHeight-offset);\r\n\r\n\r\n            ctx.stroke();\r\n            console.log(\"Done drawing\");\r\n\r\n            return canvas;\r\n        }\r\n    },\r\n};\r\n\r\n\r\nfunction generateYLabels(values,amount) {\r\n    const min = Math.min(...values);\r\n    const max = Math.max(...values);\r\n\r\n    const delta = (max - min)/(amount-1);\r\n    const output = [];\r\n    for(let i = 0;i<=(amount-1);i++)\r\n        output.push(min+(delta*i));\r\n\r\n    return output;\r\n}\r\n\r\nfunction line(context,x1,y1,x2,y2,lineWidth = 1) {\r\n    context.lineWidth = lineWidth;\r\n    context.moveTo(x1,y1);\r\n    context.lineTo(x2,y2);\r\n\r\n}\r\n\r\nfunction normalize(array) {\r\n    const min = Math.min(...array);\r\n    const max = Math.max(...array) - min;\r\n    return array.map(e => (e - min) / max);\r\n}\r\nif(nxtx) nxtx.registerPackage(pkg);\r\n\r\n\r\nexport default pkg;"],"names":[],"mappings":"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"}